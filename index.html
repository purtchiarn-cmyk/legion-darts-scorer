<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Legion Darts Scorer v3.0</title>
<style>
  :root {
    --primary-bg: #f3f3f3;
    --primary-text: #222;
    --accent: #007aff;
    --accent-light: #4da3ff;
    --dark-bg: #121212;
    --dark-text: #eee;
    --win-color: #00c853;
    --error-color: #e53935;
    --highlight: rgba(0,122,255,0.15);
  }
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
    background: var(--primary-bg);
    color: var(--primary-text);
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background: var(--dark-bg);
    color: var(--dark-text);
  }
  header {
    width: 100%;
    text-align: center;
    padding: 0.5em;
    font-weight: bold;
    font-size: 1.4em;
  }
  .version {
    position: absolute;
    bottom: 8px;
    right: 12px;
    font-size: 0.75em;
    opacity: 0.6;
  }
  .scoreboard {
    display: flex;
    justify-content: space-around;
    align-items: center;
    width: 100%;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }
  body.dark .scoreboard {
    border-color: rgba(255,255,255,0.1);
  }
  .player {
    text-align: center;
    flex: 1;
  }
  .player h2 {
    margin: 0;
    font-size: 1.1em;
  }
  .score {
    font-size: 2.4em;
    margin-top: 4px;
  }
  .avg {
    font-size: 0.9em;
    margin-top: 2px;
    color: var(--accent);
  }
  .keypad {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    width: 95%;
    margin-top: 8px;
  }
  button {
    font-size: 1.1em;
    padding: 0.8em;
    border: none;
    border-radius: 6px;
    background: #ddd;
    color: #000;
    transition: all 0.2s;
  }
  button:hover {
    background: #ccc;
  }
  body.dark button {
    background: #333;
    color: #eee;
  }
  .controls {
    display: flex;
    justify-content: space-evenly;
    width: 95%;
    margin-top: 8px;
  }
  .controls button {
    flex: 1;
    margin: 0 4px;
  }
  .icon-bar {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 18px;
    margin: 10px 0;
  }
  .icon {
    width: 28px;
    height: 28px;
    fill: currentColor;
    opacity: 0.8;
    cursor: pointer;
    transition: transform 0.2s, opacity 0.3s;
  }
  .icon:hover {
    transform: scale(1.1);
    opacity: 1;
  }
  .tooltip {
    position: absolute;
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75em;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .tooltip.show {
    opacity: 1;
  }
  .modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.95);
    color: #000;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: none;
    width: 80%;
    max-width: 320px;
    text-align: center;
    z-index: 10;
  }
  body.dark .modal {
    background: rgba(30,30,30,0.95);
    color: #fff;
  }
  .modal.active {
    display: block;
  }
  .modal h3 {
    margin-top: 0;
  }
  .dark-toggle {
    position: absolute;
    top: 8px;
    right: 10px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <header>Legion Darts Scorer</header>
  <div class="dark-toggle">ðŸŒ—</div>
  <div class="scoreboard">
    <div class="player" id="p1">
      <h2>Home (P1)</h2>
      <div class="score" id="score1">501</div>
      <div class="avg" id="avg1">3DA: 0.00</div>
    </div>
    <div class="player" id="p2">
      <h2>Away (P2)</h2>
      <div class="score" id="score2">501</div>
      <div class="avg" id="avg2">3DA: 0.00</div>
    </div>
  </div>

  <div class="icon-bar">
    <!-- 3 Dart Scorer -->
    <svg id="threeDartBtn" class="icon" viewBox="0 0 24 24"><path d="M12 2L15 8l-3 2-3-2 3-6zm0 22l3-6-3-2-3 2 3 6zm10-10l-6-3-2 3 2 3 6-3zM2 12l6 3 2-3-2-3-6 3z"/></svg>
    <!-- Checkout -->
    <svg id="checkoutBtn" class="icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm0-2h13V6H6V4H2v2h2l3.6 7.59L5.25 17H19v-2H7.42l.93-2zM17 18c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2z"/></svg>
    <!-- Coin -->
    <svg id="coinBtn" class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4z"/></svg>
    <!-- Stats -->
    <svg id="statsBtn" class="icon" viewBox="0 0 24 24"><path d="M3 17h2v-7H3v7zm4 0h2V7H7v10zm4 0h2v-4h-2v4zm4 0h2V3h-2v14zm4 0h2v-9h-2v9z"/></svg>
  </div>

  <div class="keypad">
    <button id="doubleBtn">D</button>
    <button id="trebleBtn">T</button>
    <button id="btn25">25</button>
    <button id="btnBull">Bull</button>
    <button id="btnNoScore">No</button>
    <!-- Numeric keypad 1â€“20 -->
  </div>

  <div class="controls">
    <button id="undoDart">Undo Dart</button>
    <button id="undoTurn">Undo Turn</button>
    <button id="coinPlaceholder">ðŸª™</button>
    <button id="submitTurn">Submit</button>
  </div>

  <div class="modal" id="checkoutModal">
    <h3>Checkout</h3>
    <div id="checkoutContent">Score: 170<br>3-Dart: T20 T20 Bull<br>2-Dart: â€”</div>
    <button onclick="closeModal('checkoutModal')">âœ• Close</button>
  </div>

  <div class="modal" id="threeDartModal">
    <h3>3-Dart Scorer</h3>
    <input type="number" id="threeDartInput" min="0" max="180" style="width:60%;padding:5px;text-align:center;font-size:1.1em;">
    <div style="margin-top:10px;">
      <button onclick="applyThreeDart()">âœ” Apply</button>
      <button onclick="bustTurn()">ðŸš« Bust</button>
      <button onclick="closeModal('threeDartModal')">âœ• Cancel</button>
    </div>
  </div>

  <div class="modal" id="statsModal">
    <h3>Match Stats</h3>
    <div style="display:flex;justify-content:space-around;">
      <div><strong>Home</strong><br>L+1<br>3DA: 0.00</div>
      <div><strong>Away</strong><br>L+1<br>3DA: 0.00</div>
    </div>
    <button onclick="closeModal('statsModal')">âœ• Close</button>
  </div>

  <div class="tooltip" id="tooltip"></div>
  <div class="version">v3.0 Legion Darts Scorer</div>

<script>
let scores = [501, 501];
let currentPlayer = 0;
let dartsThisTurn = [];
let totalDarts = [0, 0];
let totalScored = [0, 0];
let first9Scored = [0, 0];
let darkMode = false;

const scoreEls = [document.getElementById("score1"), document.getElementById("score2")];
const avgEls = [document.getElementById("avg1"), document.getElementById("avg2")];
const tooltip = document.getElementById("tooltip");

function updateDisplay() {
  for (let i = 0; i < 2; i++) {
    scoreEls[i].textContent = scores[i];
    let darts = totalDarts[i] || 1;
    let avg = totalScored[i] / (darts / 3);
    avgEls[i].textContent = `3DA: ${isNaN(avg) ? "0.00" : avg.toFixed(2)}`;
  }
  document.getElementById("p1").style.background = currentPlayer === 0 ? "var(--highlight)" : "none";
  document.getElementById("p2").style.background = currentPlayer === 1 ? "var(--highlight)" : "none";
}

function addScore(val) {
  if (dartsThisTurn.length >= 3) return; // prevent more than 3 darts
  dartsThisTurn.push(val);
}

function undoDart() {
  dartsThisTurn.pop();
}

function undoTurn() {
  if (totalDarts[currentPlayer] >= 3) {
    totalDarts[currentPlayer] -= 3;
  }
  // remove the previous turnâ€™s score effect
  const lastThree = dartsThisTurn.reduce((a,b)=>a+b,0);
  scores[currentPlayer] += lastThree;
  dartsThisTurn = [];
  updateDisplay();
}

function submitTurn() {
  let total = dartsThisTurn.reduce((a, b) => a + b, 0);
  if (total > scores[currentPlayer]) {
    bustTurn();
    return;
  }
  scores[currentPlayer] -= total;
  totalScored[currentPlayer] += total;
  totalDarts[currentPlayer] += dartsThisTurn.length;

  if (totalDarts[currentPlayer] <= 9) first9Scored[currentPlayer] += total;

  dartsThisTurn = [];
  if (scores[currentPlayer] === 0) {
    alert(`ðŸ† Congratulations Sharp Shooter!\nPlayer ${currentPlayer + 1} wins!`);
    resetGame();
    return;
  }
  currentPlayer = 1 - currentPlayer;
  updateDisplay();
}

function bustTurn() {
  dartsThisTurn = [];
  currentPlayer = 1 - currentPlayer;
  updateDisplay();
}

function resetGame() {
  scores = [501, 501];
  currentPlayer = 0;
  dartsThisTurn = [];
  totalDarts = [0, 0];
  totalScored = [0, 0];
  first9Scored = [0, 0];
  updateDisplay();
}

function showTooltip(text, el) {
  tooltip.textContent = text;
  const rect = el.getBoundingClientRect();
  tooltip.style.left = rect.left + rect.width/2 - tooltip.offsetWidth/2 + "px";
  tooltip.style.top = rect.top - 30 + "px";
  tooltip.classList.add("show");
  setTimeout(() => tooltip.classList.remove("show"), 1500);
}

// Dark mode toggle
document.querySelector(".dark-toggle").addEventListener("click", () => {
  darkMode = !darkMode;
  document.body.classList.toggle("dark");
});

// Modals
function closeModal(id) {
  document.getElementById(id).classList.remove("active");
}

// Show Checkout
document.getElementById("checkoutBtn").addEventListener("click", () => {
  document.getElementById("checkoutModal").classList.add("active");
});

// 3 Dart Scorer
document.getElementById("threeDartBtn").addEventListener("click", () => {
  document.getElementById("threeDartModal").classList.add("active");
});
function applyThreeDart() {
  const val = parseInt(document.getElementById("threeDartInput").value);
  if (!isNaN(val)) {
    dartsThisTurn = [val];
    submitTurn();
  }
  closeModal("threeDartModal");
}

// Stats
document.getElementById("statsBtn").addEventListener("click", () => {
  document.getElementById("statsModal").classList.add("active");
});

// Buttons logic
document.getElementById("submitTurn").addEventListener("click", submitTurn);
document.getElementById("undoDart").addEventListener("click", undoDart);
document.getElementById("undoTurn").addEventListener("click", undoTurn);
document.getElementById("coinPlaceholder").addEventListener("click", () => showTooltip("Coin flip placeholder", event.target));

// Keypad
const keypad = document.querySelector(".keypad");
for (let i = 1; i <= 20; i++) {
  const btn = document.createElement("button");
  btn.textContent = i;
  btn.onclick = () => addScore(i);
  keypad.appendChild(btn);
}

document.getElementById("btn25").onclick = () => addScore(25);
document.getElementById("btnBull").onclick = () => addScore(50);
document.getElementById("btnNoScore").onclick = () => addScore(0);

document.getElementById("doubleBtn").onclick = (e) => {
  e.target.classList.toggle("active");
  showTooltip("Double active", e.target);
};
document.getElementById("trebleBtn").onclick = (e) => {
  e.target.classList.toggle("active");
  showTooltip("Treble active", e.target);
};

updateDisplay();
</script>
</body>
</html>
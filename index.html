<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Legion Darts Scorer v2.3</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Montserrat', sans-serif;
    background: #f0f8ff;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 { margin-top: 10px; color: #003366; }
  .scoreboard {
    display: flex;
    justify-content: space-around;
    width: 95%;
    margin: 10px 0;
    position: relative;
  }
  .player {
    text-align: center;
    padding: 10px;
    border: 2px solid #003366;
    border-radius: 10px;
    width: 45%;
    position: relative;
  }
  .active {
    animation: pulse 1s infinite;
    border-color: #0066cc;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 5px #0066cc; }
    50% { box-shadow: 0 0 15px #0066cc; }
    100% { box-shadow: 0 0 5px #0066cc; }
  }
  .dart-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-gap: 8px;
    width: 95%;
    margin-bottom: 10px;
  }
  button {
    padding: 12px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    background-color: #0073e6;
    color: white;
  }
  button:hover { background-color: #005bb5; }
  .stats-overlay {
    display: none;
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
  }
  .stats-content {
    background: #f0f8ff;
    padding: 20px;
    border-radius: 15px;
    width: 85%;
    max-width: 400px;
    text-align: center;
    animation: fadeIn 0.8s;
  }
  .close-btn {
    position: absolute;
    top: 10px; right: 20px;
    font-size: 24px;
    cursor: pointer;
    color: #003366;
  }
  @keyframes fadeIn { from {opacity:0;} to{opacity:1;} }
  .dart-value { font-size: 14px; color: #003366; margin-top: 2px; }
  .message { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
             font-size:32px; color:red; display:none; font-weight:bold; }
  .threeDA { font-size: 14px; color:red; margin-top:4px; }
</style>
</head>
<body>

<h1>Legion Darts Scorer v2.3</h1>

<div class="scoreboard">
  <div id="home" class="player active">
    Home (P1)<br>
    <span id="home-score">501</span>
    <div class="threeDA" id="home-3da"></div>
    <div id="home-darts" class="dart-value"></div>
  </div>
  <div id="away" class="player">
    Away (P2)<br>
    <span id="away-score">501</span>
    <div class="threeDA" id="away-3da"></div>
    <div id="away-darts" class="dart-value"></div>
  </div>
</div>

<div class="message" id="message"></div>

<div class="dart-buttons">
  <button onclick="setMultiplier('D')">D</button>
  <button onclick="setMultiplier('T')">T</button>
  <button onclick="setMultiplier('1')">1</button>
  <button onclick="setMultiplier('2')">2</button>

  <button onclick="setMultiplier('3')">3</button>
  <button onclick="setMultiplier('4')">4</button>
  <button onclick="setMultiplier('5')">5</button>
  <button onclick="setMultiplier('6')">6</button>

  <button onclick="setMultiplier('7')">7</button>
  <button onclick="setMultiplier('8')">8</button>
  <button onclick="setMultiplier('9')">9</button>
  <button onclick="setMultiplier('10')">10</button>

  <button onclick="setMultiplier('11')">11</button>
  <button onclick="setMultiplier('12')">12</button>
  <button onclick="setMultiplier('13')">13</button>
  <button onclick="setMultiplier('14')">14</button>

  <button onclick="setMultiplier('15')">15</button>
  <button onclick="setMultiplier('16')">16</button>
  <button onclick="setMultiplier('17')">17</button>
  <button onclick="setMultiplier('18')">18</button>

  <button onclick="setMultiplier('19')">19</button>
  <button onclick="setMultiplier('20')">20</button>
  <button onclick="setMultiplier('25')">25</button>
  <button onclick="setMultiplier('B')">Bull</button>

  <button onclick="showStats()">üìä</button>
  <button onclick="undoLastDart()">‚Ü©Ô∏è Dart</button>
  <button onclick="submitTurn()">‚úîÔ∏è Turn</button>
  <button onclick="undoLastTurn()">‚Ü©Ô∏è Turn</button>
</div>

<div class="stats-overlay" id="statsOverlay">
  <div class="stats-content">
    <span class="close-btn" onclick="closeStats()">√ó</span>
    <h2>Stats Overlay</h2>
    <p id="statsText"></p>
  </div>
</div>

<script>
let homeScore = 501;
let awayScore = 501;
let currentPlayer = 'home';
let dartsThisTurn = [];
let allDarts = { home: [], away: [] };
let multiplier = 1;

function setMultiplier(val){
  if(val === 'D'){ multiplier = 2; return; }
  if(val === 'T'){ multiplier = 3; return; }
  if(val === 'B'){ val = 25; multiplier = 2; } 
  val = parseInt(val);
  recordDart(val * multiplier, val + (multiplier>1? ` (${multiplier}x)` : '' ));
  multiplier = 1; // reset after use
}

function recordDart(scoreVal, label){
  if(dartsThisTurn.length >=3){ showMessage("Max 3 darts!"); return; }
  dartsThisTurn.push({score:scoreVal, label:label});
  allDarts[currentPlayer].push({score:scoreVal, label:label});
  updateScoreboard();
}

function updateScoreboard(){
  let scoreEl = document.getElementById(currentPlayer+'-score');
  let dartsEl = document.getElementById(currentPlayer+'-darts');
  let currentScore = (currentPlayer==='home'? homeScore: awayScore);
  let turnScore = dartsThisTurn.reduce((a,b)=>a+b.score,0);
  let newScore = currentScore - turnScore;
  if(newScore<0){ showMessage("BUST!"); dartsThisTurn=[]; updateScoreboard(); return; }
  scoreEl.textContent = newScore;
  dartsEl.innerHTML = dartsThisTurn.map(d=>d.label).join(' | ');
  document.getElementById(currentPlayer+'-3da').textContent = `3DA: ${calculate3DA(currentPlayer)}`;
}

function calculate3DA(player){
  let darts = allDarts[player].map(d=>d.score);
  let total = darts.reduce((a,b)=>a+b,0);
  return darts.length? (total/darts.length*3).toFixed(1) : '';
}

function submitTurn(){
  if(dartsThisTurn.length===0){ showMessage("Enter at least 1 dart"); return; }
  let scoreEl = document.getElementById(currentPlayer+'-score');
  if(currentPlayer==='home'){ homeScore=parseInt(scoreEl.textContent); currentPlayer='away'; } 
  else{ awayScore=parseInt(scoreEl.textContent); currentPlayer='home'; }
  dartsThisTurn=[];
  updateActivePlayer();
}

function updateActivePlayer(){
  document.getElementById('home').classList.remove('active');
  document.getElementById('away').classList.remove('active');
  document.getElementById(currentPlayer).classList.add('active');
}

function undoLastDart(){
  if(dartsThisTurn.length>0){ dartsThisTurn.pop(); updateScoreboard(); }
}

function undoLastTurn(){
  if(allDarts[currentPlayer].length>0){
    for(let i=0;i<3;i++){ if(allDarts[currentPlayer].length>0) allDarts[currentPlayer].pop(); }
    updateScoreboard();
  }
}

function showMessage(msg){
  let el = document.getElementById('message');
  el.textContent = msg;
  el.style.display='block';
  setTimeout(()=>{ el.style.display='none'; }, 1000);
}

function showStats(){
  let overlay = document.getElementById('statsOverlay');
  overlay.style.display='flex';
  let text = '';
  ['home','away'].forEach(p=>{
    text += `${p.toUpperCase()} 3DA: ${calculate3DA(p)} | First9 Avg: --- | High Turn: --- <br>`;
  });
  document.getElementById('statsText').innerHTML = text;
}

function closeStats(){
  document.getElementById('statsOverlay').style.display='none';
}
</script>
</body>
</html>